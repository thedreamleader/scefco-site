---
import { Image } from "astro:assets";
import LombaTemplate from "./lomba-template.astro";
import Competitions_Title from "../images/titles/comps.png";
---
<Image class="hoverPop" id="comp_title" src={Competitions_Title} alt="Competitions" />
<div id="horizontal-scroll">
  <div id="carousel-container">
    <div class="carousel-space"></div>
    <LombaTemplate id="StoryTelling"  class="cards" namaLomba="STORY TELLING"             linkLomba="https://forms.gle/ZvPZfgx8NBb7baEu6" juknisLomba="https://drive.google.com/file/d/1hayw5ltfp2egrHCZ-5GW61kLAOq7VKP4/view?usp=drive_link"/>
    <LombaTemplate id="OlimpiadeIPA"  class="cards" namaLomba="OLIM. IPA"                 linkLomba="https://forms.gle/aPSQKqpKqSBJ1ixx6" juknisLomba="https://drive.google.com/file/d/1ty5vwL8b0Pk7mAYdByBu4EHl9bGCyGLq/view?usp=drive_link"/>
    <LombaTemplate id="OlimpiadeIPS"  class="cards" namaLomba="OLIM. IPS"                 linkLomba="https://forms.gle/aZVLEYFdLUt9ucVy8" juknisLomba="https://drive.google.com/file/d/1N-i81szwVRu6Mht0NDX_ujumSlbo1wkT/view?usp=drive_link"/>
    <LombaTemplate id="Mhq"           class="cards" namaLomba="MHQ" subtitleLomba="(SMP)" linkLomba="https://forms.gle/AubgBiNoxG2QF8eE8" juknisLomba="https://drive.google.com/file/d/1HsZj0GTB4WS1umccbqsWdUlH-Y0yBxM_/view?usp=drive_link"/>
    <LombaTemplate id="Mhq"           class="cards" namaLomba="MHQ" subtitleLomba="(SMA)" linkLomba="https://forms.gle/Qjqmdag8jhN7oUCz7" juknisLomba="https://drive.google.com/file/d/1bMsIb6F0mOMJbvbYebLN_svz7puoIVN5/view?usp=drive_link"/> 
    <LombaTemplate id="EnglishSpeech" class="cards" namaLomba="ENGLISH SPEECH"            linkLomba="https://forms.gle/XA1bF6WPQ5ZB4M1j6" juknisLomba="https://drive.google.com/file/d/17CS-yZGeyS6VEE1IlpjdRI7svrJ_dEAb/view?usp=drive_link"/>
    <LombaTemplate id="Futsal"        class="cards" namaLomba="FUTSAL"                    linkLomba="https://forms.gle/mK2YBXkxhBomyhLTA" juknisLomba="https://drive.google.com/file/d/16xD_ZHFUjZ4YPMz98ndaGCVBF3Q3URGS/view?usp=drive_link"/>
    <LombaTemplate id="RatohJaroe"    class="cards" namaLomba="RATOH JAROE"               linkLomba="https://forms.gle/oHZTSNqAHpXsk2bC6" juknisLomba="https://drive.google.com/file/d/1NJuGu1IoZKfwS_0CYVwcw31qrb38dSUL/view?usp=drive_link"/>
    <LombaTemplate id="Esai"          class="cards" namaLomba="ESAI"                      linkLomba="https://forms.gle/KGrmQg4DQTz4x1kQ7" juknisLomba="https://drive.google.com/file/d/1gmvRMGYmQfv5eWo7W7ZzR1OHVtazAzmn/view?usp=drive_link"/>
    <div class="carousel-space"></div>
</div>

<div id="instructions" class="hoverPop">
  <h6>click and drag to scroll</h6>
</div>

<style is:global>
  /* * {
    border: 1px solid  red;
  }  */
  @media only screen and (min-width: 720px) {
    #RatohJaroe {
      background: url("../images/bg-lomba/ratohjaroe.png");
      background-size: 100% 100%;
    
    }
    #EnglishSpeech {
      background: url("../images/bg-lomba/englishspeech.png");
      background-size: 100% 100%;
    }

    #Esai {
      background: url("../images/bg-lomba/essay.png");
      background-size: 100% 100%;
    }

    #Futsal {
      background: url("../images/bg-lomba/futsal.png");
      background-size: 100% 100%;
    }

    #Mhq {
      background: url("../images/bg-lomba/MHQ.png");
      background-size: 100% 100%;
    }
    #StoryTelling {
      background: url("../images/bg-lomba/storytelling.png");
      background-size: 100% 100%;
    }

    #OlimpiadeIPA {
      background: url("../images/bg-lomba/olimpiadeIPA.png");
      background-size: 100% 100%;
    }

    #OlimpiadeIPS {
      background: url("../images/bg-lomba/olimpiadeIPS.png");
      background-size: 100% 100%;
    }

  }

  @media only screen and (max-width: 720px) {
    .cards {
      background: #7282E3;
      background-size: 100% 100%;
    }

    .lomba-title {
      margin-top: 7vw;
      padding-left: 10vw;
      padding-right: 10vw;
    }

    #RatohJaroe {
      background: url("../images/bg-lomba-mobile/ratohjaroemobile.png");
      background-size: 100% 100%;
    
    }
    #EnglishSpeech {
      background: url("../images/bg-lomba-mobile/englishspeechmobile.png");
      background-size: 100% 100%;
    }

    #Esai {
      background: url("../images/bg-lomba-mobile/essaymobile.png");
      background-size: 100% 100%;
    }

    #Futsal {
      background: url("../images/bg-lomba-mobile/futsalmobile.png");
      background-size: 100% 100%;
    }

    #Mhq {
      background: url("../images/bg-lomba-mobile/mhqmobile.png");
      background-size: 100% 100%;
    }

    #StoryTelling {
      background: url("../images/bg-lomba-mobile/storytellingmobile.png");
      background-size: 100% 100%;
    }

    #OlimpiadeIPA {
      background: url("../images/bg-lomba-mobile/olimpiadeIPAmobile.png");
      background-size: 100% 100%;
    }

    #OlimpiadeIPS {
      background: url("../images/bg-lomba-mobile/olimpiadeIPSmobile.png");
      background-size: 100% 100%;
    }
  }
</style>
<style>
  #instructions {
    background-color: #BDF0C6;
    padding: 5px;
    margin-top: 10px;
    border-radius: 12px;
    font-size: var(--p-fz);
    }
  #carousel-container {
    display: flex;
    gap: 5px;
    padding: 5px;
    align-items: center;
    height: 32vw;
    background-color: transparent;
    width: max-content;
    
  }

  #horizontal-scroll {
    width: 100%;
    height: 32vw;
    overflow-x: scroll;
    overflow-y: hidden;
    cursor: grab;
    background-color: transparent;
  }

  #horizontal-scroll.active {
    cursor: grabbing;
  }

  #comp_title {
    width: 50vw;
    height: 10vw;
  }

  .carousel-space {
    width: 28vw;
    height: 40vh;
    background-color: transparent;
  }

  .carousel-item:hover {
    transform: scale(1.2);
  }

  @media only screen and (max-width: 720px) {
    .carousel-space {
        width: 15vw;
      }
    #comp_title {
      width: 90vw;
      height: 18vw;
      margin-bottom: -5vh;
      z-index: 5;
    }
    
    #horizontal-scroll {
      height: 80vh;
    }

    #carousel-container {
      height: 75vh;
    }
  }
</style>

<script>
  let deviceWidth = Math.max(
    document.documentElement.clientWidth || 0,
    window.innerWidth || 0
  );
  if (deviceWidth <= 720) {
    console.log("Mobile")
    const carouselItems = document.querySelectorAll(".carousel-item");
    // Create an intersection observer to track visibility of elements
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("in-view"); // Add scale when in view
          } else {
            entry.target.classList.remove("in-view"); // Remove scale when out of view
          }
        });
      },
      {
        threshold: 0.9, // Adjust threshold so element has to be at least 50% visible to trigger
      }
    );

    // Observe each carousel item
    carouselItems.forEach((item) => {
      observer.observe(item);
    });
  } else {
    console.log("PC")
    const slider = document.querySelector("#horizontal-scroll");
    let isDown = false;
    let startX;
    let scrollLeft;

    slider.addEventListener("mousedown", (e) => {
      isDown = true;
      slider.classList.add("active");
      startX = e.pageX - slider.offsetLeft;
      scrollLeft = slider.scrollLeft;
    });

    slider.addEventListener("mouseleave", () => {
      isDown = false;
      slider.classList.remove("active");
    });

    slider.addEventListener("mouseup", () => {
      isDown = false;
      slider.classList.remove("active");
    });

    slider.addEventListener("mousemove", (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - slider.offsetLeft;
      const walk = (x - startX) * 2; // Adjust scrolling speed
      slider.scrollLeft = scrollLeft - walk;
    });

    document.addEventListener("DOMContentLoaded", function () {
      const container = document.getElementById("horizontal-scroll");
      const carouselItems = document.querySelectorAll(".carousel-item");

      // Adjust this index to target the 4th item (index 3 for zero-based indexing)
      const targetItemIndex = 3;
      const targetItem = carouselItems[targetItemIndex];

      // Calculate the distance between the container and the target item
      const targetPosition = targetItem.offsetLeft - container.offsetLeft;

      // Scroll the container to the target position smoothly
      container.scrollTo({
        left:
          targetPosition -
          container.clientWidth / 2 +
          targetItem.clientWidth / 2, // Center the item
        behavior: "smooth", // Smooth scrolling
      });
    });
  }
</script>
